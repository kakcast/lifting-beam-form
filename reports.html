<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Lifting Beam Inspection System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .reports-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .reports-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .reports-nav {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .reports-nav a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            padding: 5px 10px;
        }
        
        .reports-nav a:hover {
            color: #4CAF50;
        }
        
        .reports-nav a.active {
            border-bottom: 2px solid #4CAF50;
        }
        
        .filter-section {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: bold;
        }
        
        .filter-group input, .filter-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .reports-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .reports-table th {
            position: sticky;
            top: 0;
            background-color: #f2f2f2;
            text-align: left;
            padding: 12px;
        }
        
        .reports-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .reports-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .action-btn {
            margin-right: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
        }
        
        .view-btn {
            background-color: #2196F3;
        }
        
        .delete-btn {
            background-color: #f44336;
        }
        
        .export-btn {
            background-color: #FF9800;
        }
        
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            cursor: pointer;
        }
        
        .pagination button.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .no-reports {
            text-align: center;
            padding: 30px;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="reports-container">
        <div class="reports-header">
            <h1>Inspection Reports</h1>
            <div class="user-info">
                Logged in as: <span id="userInfo"></span>
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </div>
        
        <div class="reports-nav">
            <a href="index.html">Inspection Form</a>
            <a href="reports.html" class="active">Reports</a>
            <a href="admin.html" class="admin-only">User Management</a>
        </div>
        
        <div class="filter-section">
            <div class="filter-group">
                <label for="dateFrom">From:</label>
                <input type="date" id="dateFrom">
            </div>
            
            <div class="filter-group">
                <label for="dateTo">To:</label>
                <input type="date" id="dateTo">
            </div>
            
            <div class="filter-group">
                <label for="inspectorFilter">Inspector:</label>
                <select id="inspectorFilter">
                    <option value="">All</option>
                </select>
            </div>
            
            <button id="filterBtn" class="action-btn">Apply Filter</button>
            <button id="exportAllBtn" class="action-btn export-btn">Export All to Excel</button>
        </div>
        
        <div class="table-container">
            <table class="reports-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Serial No.</th>
                        <th>Inspector</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="reportsList">
                    <!-- Reports will be populated by JavaScript -->
                </tbody>
            </table>
            
            <div id="noReports" class="no-reports" style="display: none;">
                No reports found. Start by submitting an inspection form.
            </div>
        </div>
        
        <div class="pagination" id="pagination">
            <!-- Pagination buttons will be added here -->
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // Additional reports page JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Load reports
            loadReports();
            
            // Filter button
            document.getElementById('filterBtn').addEventListener('click', function() {
                loadReports();
            });
            
            // Export button
            document.getElementById('exportAllBtn').addEventListener('click', function() {
                exportReports();
            });
        });
        
        function loadReports() {
            const reports = JSON.parse(localStorage.getItem('liftingBeamReports') || '[]');
            const reportsList = document.getElementById('reportsList');
            const noReports = document.getElementById('noReports');
            
            // Apply filters
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const inspector = document.getElementById('inspectorFilter').value;
            
            let filteredReports = [...reports];
            
            if (dateFrom) {
                filteredReports = filteredReports.filter(report => 
                    new Date(report.inspectionDate) >= new Date(dateFrom)
                );
            }
            
            if (dateTo) {
                filteredReports = filteredReports.filter(report => 
                    new Date(report.inspectionDate) <= new Date(dateTo)
                );
            }
            
            if (inspector) {
                filteredReports = filteredReports.filter(report => 
                    report.inspectorName === inspector
                );
            }
            
            // Clear list
            reportsList.innerHTML = '';
            
            // Show/hide no reports message
            if (filteredReports.length === 0) {
                noReports.style.display = 'block';
                return;
            } else {
                noReports.style.display = 'none';
            }
            
            // Add reports to table
            filteredReports.forEach((report, index) => {
                const row = document.createElement('tr');
                
                const dateCell = document.createElement('td');
                dateCell.textContent = report.inspectionDate || 'N/A';
                
                const serialCell = document.createElement('td');
                serialCell.textContent = report.serialNo || 'N/A';
                
                const inspectorCell = document.createElement('td');
                inspectorCell.textContent = report.inspectorName || 'N/A';
                
                const locationCell = document.createElement('td');
                locationCell.textContent = report.placeSurvey || 'N/A';
                
                const statusCell = document.createElement('td');
                // Determine status based on findings
                let status = 'OK';
                if (report.criticalFinding) status = 'Critical Issue';
                else if (report.minorFinding) status = 'Minor Issue';
                statusCell.textContent = status;
                
                const actionsCell = document.createElement('td');
                
                const viewBtn = document.createElement('button');
                viewBtn.textContent = 'View';
                viewBtn.className = 'action-btn view-btn';
                viewBtn.onclick = function() {
                    viewReport(index);
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.onclick = function() {
                    if (confirm('Are you sure you want to delete this report?')) {
                        deleteReport(index);
                    }
                };
                
                actionsCell.appendChild(viewBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(dateCell);
                row.appendChild(serialCell);
                row.appendChild(inspectorCell);
                row.appendChild(locationCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                reportsList.appendChild(row);
            });
            
            // Update inspector filter options
            updateInspectorOptions(reports);
        }
        
        function viewReport(index) {
            const reports = JSON.parse(localStorage.getItem('liftingBeamReports') || '[]');
            const report = reports[index];
            
            // In a real application, you would redirect to a report view page
            // For this demo, we'll just alert the details
            alert(`Report Details:\n\nDate: ${report.inspectionDate}\nSerial No: ${report.serialNo}\nInspector: ${report.inspectorName}`);
        }
        
        function deleteReport(index) {
            let reports = JSON.parse(localStorage.getItem('liftingBeamReports') || '[]');
            
            // Remove the report
            reports.splice(index, 1);
            
            // Save updated reports
            localStorage.setItem('liftingBeamReports', JSON.stringify(reports));
            
            // Reload reports list
            loadReports();
        }
        
        function updateInspectorOptions(reports) {
            const inspectorFilter = document.getElementById('inspectorFilter');
            const currentSelection = inspectorFilter.value;
            
            // Clear options except first one
            while (inspectorFilter.options.length > 1) {
                inspectorFilter.remove(1);
            }
            
            // Get unique inspectors
            const inspectors = [...new Set(reports.map(report => report.inspectorName).filter(name => name))];
            
            // Add options
            inspectors.forEach(inspector => {
                const option = document.createElement('option');
                option.value = inspector;
                option.textContent = inspector;
                inspectorFilter.appendChild(option);
            });
            
            // Restore selection if possible
            if (currentSelection && inspectors.includes(currentSelection)) {
                inspectorFilter.value = currentSelection;
            }
        }
        
        function exportReports() {
            const reports = JSON.parse(localStorage.getItem('liftingBeamReports') || '[]');
            
            if (reports.length === 0) {
                alert('No reports to export.');
                return;
            }
            
            // In a real application, you would generate an Excel file
            // For this demo, we'll just alert
            alert('Export functionality would download an Excel file with all reports.');
        }
    </script>
</body>
</html>